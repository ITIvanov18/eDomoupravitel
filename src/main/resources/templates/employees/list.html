<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="">

<head>
    <meta charset="UTF-8">
    <title>Employees</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="/css/style.css" rel="stylesheet">
</head>

<body>
<div th:replace="~{header :: header}"></div>

<div class="container mt-4 mb-5">
    <div class="d-flex justify-content-between align-items-center mb-4">

    <h2>Employees</h2>
        <div class="d-flex gap-2">
            <div class="dropdown">
                <button class="btn btn-outline-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown">
                    <i class="fas fa-sort-amount-down-alt me-1"></i> Sort
                </button>
                <ul class="dropdown-menu dropdown-menu-end">
                    <li><h6 class="dropdown-header">By Name</h6></li>
                    <li><a class="dropdown-item" th:classappend="${currentSort == 'name_asc'} ? 'active'" href="?sort=name_asc">A-Z</a></li>
                    <li><a class="dropdown-item" th:classappend="${currentSort == 'name_desc'} ? 'active'" href="?sort=name_desc">Z-A</a></li>
                    <li><hr class="dropdown-divider"></li>
                    <li><h6 class="dropdown-header">By Workload</h6></li>
                    <li><a class="dropdown-item" th:classappend="${currentSort == 'buildings_desc'} ? 'active'" href="?sort=buildings_desc">Most Buildings First</a></li>
                    <li><a class="dropdown-item" th:classappend="${currentSort == 'buildings_asc'} ? 'active'" href="?sort=buildings_asc">Least Buildings First</a></li>
                </ul>
            </div>

            <button type="button" class="btn btn-primary text-white"
                    style="background-color: var(--primary-color); border-color: var(--primary-color);"
                    data-bs-toggle="modal"
                    data-bs-target="#createEmployeeModal">
                <i class="fas fa-plus"></i> New Employee
            </button>
        </div>
    </div>

    <div class="card shadow-sm border-0">
        <div class="card-body p-0">
            <table class="table table-hover align-middle mb-0">
                <thead class="table-light">
                <tr>
                    <th class="ps-4">Employee</th>
            <th>Company</th>
            <th>Assigned Buildings</th>
            <th class="text-end pe-4">Actions</th>

        </tr>
        </thead>
        <tbody>
        <tr th:each="employee : ${employees}">
            <td class="ps-4">
                <div class="d-flex align-items-center">
                    <div class="bg-light rounded-circle d-flex align-items-center justify-content-center me-3"
                         style="width: 40px; height: 40px;">
                        <i class="fas fa-user text-secondary"></i>
                    </div>
                    <div>
                        <div class="fw-bold text-dark" th:text="${employee.firstName} + ' ' + ${employee.lastName}">Name</div>
                        <div class="small text-muted">
                            <i class="fas fa-phone-alt fa-xs me-1"></i>
                            <span th:text="${employee.phoneNumber}">Phone</span>
                        </div>
                    </div>
                </div>
            </td>

            <td>
                        <span th:if="${employee.companyName}"
                              class="badge rounded-pill text-bg-light border border-secondary-subtle text-secondary fw-normal px-3 py-2">
                            <i class="far fa-building me-1"></i>
                            <span th:text="${employee.companyName}">Company</span>
                        </span>
                <span th:unless="${employee.companyName}" class="text-muted small fst-italic">Freelancer</span>
            </td>

            <td>

                <div th:if="${employee.buildingCount > 0}">
                    <div class="mb-1">
                                <span class="badge bg-primary bg-opacity-10 text-primary mb-1">
                                    <span th:text="${employee.buildingCount}">5</span> Active assignments
                                </span>
                    </div>
                    <div class="d-flex flex-column gap-1">
                        <div th:each="addr : ${employee.buildingAddresses}" class="d-flex align-items-start">
                            <i class="fas fa-map-marker-alt text-danger mt-1 me-2 small" style="opacity: 0.7;"></i>
                            <span class="small text-dark" th:text="${addr}">Address</span>
                        </div>
                    </div>
                </div>
                <div th:if="${employee.buildingCount == 0}">
                            <span class="text-muted small op-50">
                                <i class="far fa-circle me-1"></i> No buildings assigned
                            </span>
                </div>
            </td>

            <td class="text-end pe-4">
                <button type="button" class="btn btn-light btn-md text-secondary border hover-shadow"
                        data-bs-toggle="modal"
                        data-bs-target="#editEmployeeModal"
                        th:data-id="${employee.id}"
                        th:data-firstname="${employee.firstName}"
                        th:data-lastname="${employee.lastName}"
                        th:data-phone="${employee.phoneNumber}"
                        th:data-company-id="${employee.companyId}"
                        title="Edit">
                    <i class="fas fa-pen"></i>
                </button>

                <form th:action="@{/employees/delete/{id}(id=${employee.id})}" th:method="delete" style="display:inline;">
                    <button type="submit" class="btn btn-light btn-md text-danger border hover-shadow ms-1"
                            onclick="return confirm('Are you sure? We will attempt redistribution.')"
                            title="Delete">
                        <i class="fas fa-trash"></i>
                    </button>
                </form>
            </td>
        </tr>
        </tbody>
    </table>
        </div>
    </div>

    <div th:if="${#lists.isEmpty(employees)}" class="alert alert-light border text-center mt-3 py-5">
        <div class="text-muted mb-3"><i class="fas fa-users fa-3x opacity-25"></i></div>
        <h5>No employees found</h5>
        <p class="text-muted">Start by creating a new employee.</p>
    </div>


    <!-- Create Employee Modal -->
    <div class="modal fade" id="createEmployeeModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header border-bottom-0 pb-0" style="background-color: var(--bg-body);">
                    <h5 class="modal-title fw-bold" style="color: var(--primary-color);">
                        <i class="fas fa-user-tie me-2"></i>Add New Employee
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form th:action="@{/employees/create}" method="post" id="createEmployeeForm">
                        <div class="mb-3">
                            <label class="form-label text-muted small fw-bold">FIRST NAME</label>
                            <div class="input-group">
                                <span class="input-group-text bg-light border-end-0"><i class="fas fa-user text-muted"></i></span>
                                <input type="text" class="form-control border-start-0 ps-0" name="firstName" placeholder="e.g. Galin" required>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label text-muted small fw-bold">LAST NAME</label>
                            <div class="input-group">
                                <span class="input-group-text bg-light border-end-0"><i class="fas fa-user text-muted"></i></span>
                                <input type="text" class="form-control border-start-0 ps-0" name="lastName" placeholder="e.g. Kostov" required>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label text-muted small fw-bold">PHONE NUMBER</label>
                            <div class="input-group">
                                <span class="input-group-text bg-light border-end-0"><i class="fas fa-phone text-muted"></i></span>
                                <input type="text" class="form-control border-start-0 ps-0" name="phoneNumber" placeholder="e.g. 0888123456" required>
                            </div>
                        </div>
                        <div class="mb-4">
                            <label class="form-label text-muted small fw-bold">COMPANY</label>
                            <div class="input-group">
                                <span class="input-group-text bg-light border-end-0"><i class="fas fa-building text-muted"></i></span>
                                <select class="form-select border-start-0 ps-0" name="companyId">
                                    <option value="" selected>-- Freelancer (No Company) --</option>
                                    <option th:each="company : ${companies}"
                                            th:value="${company.id}"
                                            th:text="${company.name}">Company Name</option>
                                </select>
                            </div>
                        </div>
                        <div class="d-grid">
                            <button type="submit" class="btn btn-primary"
                                    style="background-color: var(--primary-color); border-color: var(--primary-color);">
                                Create Employee
                            </button>
                        </div>
                    </form>
                </div>
            </div>
    </div>
</div>

<!-- Edit Employee Modal -->
    <div class="modal fade" id="editEmployeeModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content border-0 shadow-lg">
                <div class="modal-header border-bottom-0 pb-0" style="background-color: var(--bg-body);">
                    <h5 class="modal-title fw-bold" style="color: var(--primary-color);">
                        <i class="fas fa-user-edit me-2"></i>Edit Employee
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body pt-4">
                    <form th:action="@{/employees/update}" method="post" id="editEmployeeForm">
                        <input type="hidden" name="id" id="editId">

                        <div class="mb-3">
                            <label class="form-label text-muted small fw-bold text-uppercase">First Name</label>
                            <div class="input-group">
                                <span class="input-group-text bg-white border-end-0 text-muted"><i class="fas fa-user"></i></span>
                                <input type="text" class="form-control border-start-0 ps-0" name="firstName" id="editFirstName" required>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label class="form-label text-muted small fw-bold text-uppercase">Last Name</label>
                            <div class="input-group">
                                <span class="input-group-text bg-white border-end-0 text-muted"><i class="fas fa-user"></i></span>
                                <input type="text" class="form-control border-start-0 ps-0" name="lastName" id="editLastName" required>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label class="form-label text-muted small fw-bold text-uppercase">Phone Number</label>
                            <div class="input-group">
                                <span class="input-group-text bg-white border-end-0 text-muted"><i class="fas fa-phone"></i></span>
                                <input type="text" class="form-control border-start-0 ps-0" name="phoneNumber" id="editPhoneNumber" required
                                       pattern="\d{10}" title="Ten digits">
                            </div>
                        </div>

                        <div class="mb-4">
                            <label class="form-label text-muted small fw-bold text-uppercase">Company</label>
                            <div class="input-group">
                                <span class="input-group-text bg-white border-end-0 text-muted"><i class="fas fa-building"></i></span>
                                <select class="form-select border-start-0 ps-0" name="companyId" id="editCompanyId">
                                    <option value="">-- Freelancer (No Company) --</option>
                                    <option th:each="company : ${companies}"
                                            th:value="${company.id}"
                                            th:text="${company.name}">Company</option>
                                </select>
                            </div>
                        </div>

                        <div class="d-grid gap-2">
                            <button type="submit" class="btn text-white py-2 fw-bold shadow-sm"
                                    style="background-color: var(--primary-color); border-color: var(--primary-color);">
                                <i class="fas fa-save me-2"></i>Save Changes
                            </button>
                            <button type="button" class="btn btn-light text-muted" data-bs-dismiss="modal">Cancel</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="/js/script.js"></script>

</body>
</html>